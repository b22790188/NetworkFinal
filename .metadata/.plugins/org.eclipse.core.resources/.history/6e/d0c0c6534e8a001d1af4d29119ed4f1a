package Msg;

import java.io.*;
import java.net.DatagramSocket;
import java.net.DatagramPacket;
import java.net.InetSocketAddress;
import character.GameFrame;
import character.StickMan;

public class Player_Move_Msg implements Msg{
	
	private int msgType = Msg.PLAYER_MOVE_MSG;
	private int x, y;
	private GameFrame client;
	private int id;
	
	public Player_Move_Msg(GameFrame client){
		this.client = client;
	}
	
	public Player_Move_Msg(int id, int x, int y){
		this.id = id;
		this.x = x;
		this.y = y;
	}
	
	/*
	 * Create stream, write parameter into stream, then send packet to server.
	 */
	@Override
	public void send(DatagramSocket ds, String serverIP, int UDP_Port) {
		ByteArrayOutputStream baos = new ByteArrayOutputStream(30);
		DataOutputStream dos = new DataOutputStream(baos);
		
		try {
			dos.writeInt(msgType);
			dos.writeInt(id);
			dos.write(x);
			dos.write(y);
		}
		catch(IOException ioe) {
			ioe.printStackTrace();
		}
		
		byte[] buf = baos.toByteArray();
		
		try {
			DatagramPacket dp = new DatagramPacket(buf, buf.length, new InetSocketAddress(serverIP,UDP_Port));
			ds.send(dp);
		}
		catch(IOException ioe) {
			ioe.printStackTrace();
		}
		
	}
	
	@Override
	public void parse(DataInputStream dis) {
		try {
			
			/*
			 * 當訊息內的ID符合某一個stickmanID時，代表那個stickman需要被更新座標，包含自己。
			 */
			int id = dis.readInt();
			for(StickMan c : client.getStickManSet()) {
				if(c.getID() == id) {
					c.setStickManX(x);
					c.setStickManY(y);

				}
			}			
		}
		catch(IOException ioe) {
			ioe.printStackTrace();
		}
	}
}
